name: Stage Azure deploy

on:
  push:
    branches:
      - stage  # Modify this to match your repository's main branch

env: 
  ENV: "stage"
jobs:
  azure-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install dependencies and build
      run: |
        cd public
        yarn build

    -  name: Create react app bundle 
      run: |
        cd public
        yarn deploy-build
    
    - name: Remove node_modules
      run: |
        cd public
        rm -rf node_modules

    - name: Zip files
      run: |
        zip -r simplyin-woo-stage.zip .
        # This will zip the entire current directory
        
    - name: Upload ZIP
      uses: actions/upload-artifact@v2
      with:
        name: my_files
        path: my_files.zip